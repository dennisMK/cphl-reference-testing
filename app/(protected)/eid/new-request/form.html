<form method="POST" action="https://www.cphluganda.org/extended_single_form" accept-charset="UTF-8" id="form_id"><input name="_token" type="hidden" value="c3NyG20irmQdSawUXbE0CL3dLGoXpAysBjnEQmCc">
    <div>
    <div class="panel">
        <div class="panel-heading"><b></b></div>
        <div class="panel-body">
                    <div class="form-section">
            <div class="alert alert-info">
            </div>
            </div>
    <div class="panel panel-primary">
        <div class="panel-heading"><b>Requesting clinician</b></div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_arvs">Entry Point: </label><br>
                        <select id="infant_entryPoint" class="form-control input-sm" required="1" name="infant_entryPoint"><option value="" selected="selected"></option><option value="53">ART Clinic</option><option value="54">EID/MBCP</option><option value="55">Lab</option><option value="56">Left Blank</option><option value="57">Maternity</option><option value="58">MCH/PMTCT/ANC</option><option value="59">OPD</option><option value="60">Other</option><option value="61">Outreach</option><option value="62">Peadiatric Ward</option><option value="63">PNC</option><option value="64">Unknown</option><option value="65">YCC/Immunisation</option><option value="83">EPI</option><option value="84">Nutrition</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="senders_name">Requested by: </label><br>
                            <input class="form-control input-sm" id="senders_name" required="1" name="senders_name" type="text" value="">
                            <!-- <input list="senders_names" name="senders_name" id="senders_name">
                            <datalist id="senders_names" name="senders_datalist">
                                
                            </datalist> -->
                            <input type="hidden" name="senders_name_hidden" id="senders_name_hidden">
                
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="senders_telephone">Tel No: </label><br>
                            <input class="form-control input-sm" id="senders_telephone" required="1" name="senders_telephone" type="text" value="">
                        </div>
                    </div>
                </div>
            </div>
    </div>
    
    <div class="panel panel-primary">
        <div class="panel-heading"><b>Patient information</b></div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="env_num1">Infant Name: </label><br>
                            <input class="form-control input-sm" id="infant_name" required="1" name="infant_name" type="text" value="">                  
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_exp_id">EXP No: </label><br>
                            <input class="form-control input-sm" id="infant_exp_id" required="1" name="infant_exp_id" type="text" value="">
                            
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_gender">Sex: </label><br>
                            <select class="form-control input-sm" id="infant_gender" required="1" name="infant_gender"><option value="" selected="selected"></option><option value="MALE">M</option><option value="FEMALE">F</option><option value="NOT_RECORDED">Blank</option></select>
                            
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_age">Age in Months: </label><br>
                            <input type="text" name="infant_age" id="infant_age" ,="" class="form-control input-sm" required="1" value=""><select class="form-control input-sm" id="infant_gender" required="1" name="infant_age_units"><option value="months">Months</option><option value="days">Days</option><option value="weeks">Weeks</option><option value="years">Years</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_contact_phone">Care Giver Phone Number: </label><br>
                            <input class="form-control input-sm" id="infant_contact_phone" name="infant_contact_phone" type="text" value="">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="given_contri">Given Contrimoxazole:: </label><br>
                            <select class="form-control input-sm" id="given_contri" required="1" name="given_contri"><option value="BLANK"></option><option value="Y">Y</option><option value="N">N</option></select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="delivered_at_hc">Delivered at H/C: </label><br>
                            <select class="form-control input-sm" id="delivered_at_hc" required="1" name="delivered_at_hc"><option value="BLANK">UNKNOWN</option><option value="Y">Y</option><option value="N">N</option></select>
                            
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_arvs">Infant PMTCT ARVS: </label><br>
                            <select class="form-control input-sm" id="infant_arvs" name="infant_arvs"><option value="" selected="selected"></option><option value="1">1-Received NVP syrup at birth for 6 weeks</option><option value="2">2-Received NVP syrup at birth for 12 weeks</option><option value="3">3-AZT/3TC/NVP</option><option value="4">4-No ARVs taken</option><option value="5">5-Unkown-Infant EMTCT regimen not known</option></select>
                            </div>
                        </div>
                        <div class="col-md-4">
                    <div class="form-inline hidden">
                        <label for="env_num1">Envelope Number: </label><br>
                        <input class="form-control" id="env_num1" required="1" onchange="autoFillDateReceived();" name="env_num1" type="text" value="20250628butabika"> 
                        
                    </div>
                </div>
                    </div>
                </div>
    </div>
    <div class="panel panel-primary">
        <div class="panel-heading"><b>Other</b></div>
            <div class="panel-body">   
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="infant_feeding">Infant Feeding: </label><br>
                        <select id="infant_feeding" class="form-control input-sm" required="1" name="infant_feeding"><option value="" selected="selected"></option><option value="EBF">Exclusive Breast Feeding</option><option value="MF">Mixed Feeding (below 6 months)</option><option value="W">Wean from breastfeeding</option><option value="RF">Replacement Feeding (never breastfed)</option><option value="CF">Complimentary Feeding (above 6 months)</option><option value="NLB">No longer Breastfeeding</option></select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-inline">
                            <label for="test_type">Type of Test:</label><br>
                            <select class="form-control input-sm" id="test_type" required="1" name="test_type"><option value="" selected="selected"></option><option value="P">PCR</option><option value="S">SCD</option><option value="B">Both</option></select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-inline">
                            <label for="pcr">PCR: </label><br>
                            <select class="form-control input-sm" id="pcr" name="pcr"><option value="UNKNOWN">Blank</option><option value="FIRST">1st</option><option value="SECOND">2nd</option><option value="THIRD">3rd</option></select>
                        </div>
                    </div>
                
                    <div class="col-md-2">
                        <div class="form-inline">
                            <label for="non_routine">Non Routine PCR: </label><br>
                            <select class="form-control input-sm" id="non_routine" name="non_routine"><option value="" selected="selected"></option><option value="R1">R1</option><option value="R2">R2</option><option value="R3">R3</option></select>
                        </div>
                    </div>
                
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="mother_htsnr">Mothers HTS No:</label><br>
                            <input class="form-control input-sm" id="mother_htsnr" name="mother_htsnr" type="text" value="">
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="mother_artnr">ART No: </label><br>
                            <input class="form-control input-sm" id="mother_artnr" name="mother_artnr" type="text" value="">
                        </div>
                    </div>
                
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="mother_nin">NIN: </label><br>
                            <input class="form-control input-sm" id="mother_nin" name="mother_nin" type="text" value="">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="artenatal">Antenatal: </label><br>
                            <select id="artenatal" class="form-control input-sm" name="mother_antenatal_prophylaxis"><option value="" selected="selected"></option><option value="80">1:Lifelong ART</option><option value="81">2:No ART</option><option value="82">3:Unknown</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="delivery">Delivery: </label><br>
                            <select id="delivery" class="form-control input-sm" name="mother_delivery_prophylaxis"><option value="" selected="selected"></option><option value="80">1:Lifelong ART</option><option value="81">2:No ART</option><option value="82">3:Unknown</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="postnatal">Postnatal: </label><br>
                            <select id="postnatal" class="form-control input-sm" name="mother_postnatal_prophylaxis"><option value="" selected="selected"></option><option value="80">1:Lifelong ART</option><option value="81">2:No ART</option><option value="82">3:Unknown</option></select>
                        </div>
                    </div>
                
                </div>
                <div class="row hidden">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="sample_type">Type of sample collected:: </label><br>
                            <select class="form-control input-sm" id="sample_type" name="sample_type"><option value="DBS">DBS</option><option value="Whole blood">Whole blood</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="first_symptom_age">Age of first symptom:: </label><br>
                            <select class="form-control input-sm" id="first_symptom_age" name="first_symptom_age"><option value="BLANK"></option><option value="1">Below 36 months</option><option value="2">3 years or above</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="diagnosis_age">Age at diagnosis:: </label><br>
                            <select class="form-control input-sm" id="diagnosis_age" name="diagnosis_age"><option value="BLANK"></option><option value="1">Below 36 months</option><option value="2">3 years or above</option></select>
                        </div>
                    </div>
                </div>
                <div class="row hidden">
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="test_reason">Reason for testing: </label><br>
                            <select class="form-control input-sm" id="test_reason" name="test_reason"><option value="" selected="selected"></option><option value="Known positive family history">Known positive family history</option><option value="Screening program">Screening program</option><option value="Illness">Illness</option><option value="Pregnancy">Pregnancy</option><option value="Surgery">Surgery</option><option value="Other">Other</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="fam_history">Known positive family history: </label><br>
                            <select class="form-control input-sm" id="fam_history" name="fam_history"><option value="" selected="selected"></option><option value="One parent with AS">One parent with AS</option><option value="Both parents with AS">Both parents with AS</option><option value="Sibling with SCD">Sibling with SCD</option><option value="Other">Other</option></select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-inline">
                            <label for="screening_program">Early screening program: </label><br>
                            <select class="form-control input-sm" id="screening_program" name="screening_program"><option value="" selected="selected"></option><option value="Birth">Birth</option><option value="First immunization">First immunization</option><option value="subsequent immunization">subsequent immunization</option><option value="Other">Other</option></select>
                        </div>
                    </div>
            </div>
        </div>          
    </div>
    <div class="row">
        <div class="col-md-4">
            <input type="submit" name="save" value="Save" class="btn btn-primary"> 
        </div> 
    </div>
    
    </div>
    
    </div>
    
    <style type="text/css">
        .row{
            margin-bottom: 15px;
        }
        #env_num1,#env_num2, #batch_number{
            color: #A9BCF5;
            font-size: 20px;
            letter-spacing: 3px;
        }
    
        #batch_number{
            width: 150px;
        }
    
        #env_num1{
            width: 250px;
        }
        
        #env_num2{
            width: 80px;
        }
    
        .input-sm{
            font-size: 15px;
        }
    </style>
    
    <script type="text/javascript">
        
        $( function() {
            $("#env_num2").focus();
            $("#facility").select2({placeholder:"Select facility", allowClear:true, width: '80%' });
    
            $("#facility").change(function(){
                var details = JSON.parse($(this).val());
                //{"facility_id":4,"facility_name":"Abim Hospital","district":"Abim"}
                //alert(details);
                $('#facility_name').val(details.facility_name);
                $('#district').val(details.district);
                $('#district_name').val(details.district);
                $('#hub').val(details.district);
    
                
                $('datalist[name="senders_datalist"]').empty();
                $('input[name="senders_name"]').val('');
                $('input[name="senders_name_hidden"]').val('');
                $('input[name="senders_telephone"]').val('');
    
                $.ajax({
                    type: 'GET',
                    url: "/getSenders/"+details.facility_id,
                    dataType: 'json',
    
                    success:function(data){
                        $('datalist[name="senders_datalist"]').empty();
                        for (var i = 0; i < data.length; i++) {
                            var sender_object = data[i];
                            $('datalist[name="senders_datalist"]').
                            append('<option data-value="'+sender_object.id+'" value="'+sender_object.name+'">');
                        }
                    },
                    error:function(err){
                        console.log(err.statusText);
                    }
                });
                
            });
    
            
            $("#date_rcvd_by_cphl").datepicker({
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                dateFormat: "yy-mm-dd"
            });
    
            
    
            $("#date_rcvd_by_cphl").change(function(){
                $( "#date_dbs_taken" ).datepicker("option",{
                    maxDate: new Date($(this).val()),
                });
            });
    
            $( "#date_dbs_taken" ).datepicker({
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                dateFormat: "yy-mm-dd"
            }); 
    
            $( "#date_dbs_taken" ).change(function(){
                $("#date_dispatched_from_facility").datepicker("option",{
                    minDate: new Date($(this).val()),
                    maxDate: new Date($("#date_rcvd_by_cphl").val()),
                });
            });
    
    
            $( "#date_dispatched_from_facility" ).datepicker({
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                dateFormat: "yy-mm-dd"
            }); 
    
            $( "#poc_test_date" ).datepicker({
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                dateFormat: "yy-mm-dd"
            });
    
            $( "#poc_dispatch_date" ).datepicker({
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                dateFormat: "yy-mm-dd"
            });
    
            $("#batch_number").change(function(){
                $.get('/batch_exists/?batch_number='+$(this).val(), function(data, status){
                    if(data==1){
                        alert('batch number already exists');
                        $("#batch_number").val('');
                        $("#batch_number").focus();
                    }
                });
            });
    
    
            var envelope_number_1_value = $("#env_num1").val;
            $("#date_rcvd_by_cphl").datepicker('setDate',new Date(envelope_number_1_value));
    
            
            
            
            
            
        });
    
        function autoFillDateReceived(){
            var envelope_number_1 = document.getElementById('env_num1');
            var envelope_number_1_value = envelope_number_1.value;
                try{
                    envelope_number_1_value = parseInt(envelope_number_1_value,10);
                            if( envelope_number_1_value > 20190101){
                                var new_date_string = envelope_number_1_value+'';
                                var new_date_array =  new_date_string.split("");
                                var final_new_date_string = new_date_array[0]+new_date_array[1]+new_date_array[2]+new_date_array[3]+'-'+new_date_array[4]+new_date_array[5]+'-'+new_date_array[6]+new_date_array[7];
                                $("#date_rcvd_by_cphl").datepicker('setDate',new Date(final_new_date_string));
                            }else{
                                   //console.log("hello hhh");
                            }   
                    }catch(err){
                        console.log(envelope_number_1_value);
                        //$("#date_rcvd_by_cphl").datepicker('setDate',new Date());
                    }
        }
        
        document.querySelector('input[list]').addEventListener('input', function(e) {
            var input = e.target,
                list = input.getAttribute('list'),
                options = document.querySelectorAll('#' + list + ' option'),
                hiddenInput = document.getElementById(input.getAttribute('senders_name') + '_hidden'),
                label = input.value;
                
    
    
            //hiddenInput.value = label;
    
            for(var i = 0; i < options.length; i++) {
                var option = options[i];
    
                if(option.value === label) {
                    //hiddenInput.value = option.dataset.value;
                    //document.getElementById("senders_name_hidden").value = option.dataset.value;
                    //document.getElementById("senders_telephone").value="000099999";
                    var sender_id = option.dataset.value;
                    $('input[name="senders_name_hidden"]').val(sender_id);
    
                    $.ajax({
                    type: 'GET',
                    url: "/getSendersTelephone/"+sender_id,
                    dataType: 'json',
    
                    success:function(data){
                        $("#senders_telephone").val(data[0].phone);
                    },
                    error:function(err){
                        console(err.statusText);
                    }
                });
                    break;
                }
            }
    
        });
    
        // For debugging purposes
        /*document.getElementById("form_id").addEventListener('submit', function(e) {
            var value = document.getElementById('answer-hidden').value;
            document.getElementById('result').innerHTML = value;
            e.preventDefault();
        });
        */
        
    </script>
        </div></form>